<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <script>
        (function() {
            const saved = localStorage.getItem('forwardog-theme');
            const theme = saved || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forwardog - Datadog Test Tool</title>
    <link rel="icon" type="image/png" href="/static/images/logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
    <!-- Highlight.js for Python syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
</head>
<body>
    <!-- Background Metrics Animation -->
    <canvas id="metrics-bg" class="metrics-background"></canvas>
    
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="/static/images/logo.png" alt="Forwardog" class="logo-img">
                    <span class="logo-text">Forwardog</span>
                </div>
                <div class="config-status">
                    <div class="config-item">
                        <span class="status-dot validating" id="api-key-status" title="Validating..."></span>
                        <span class="label">API Key:</span>
                        <span>{{ config.masked_api_key }}</span>
                    </div>
                    <div class="config-item">
                        <span class="label">Site:</span>
                        <span>{{ config.dd_site }}</span>
                    </div>
                    <div class="config-item">
                        <span class="label">Agent:</span>
                        <span>{{ config.dd_agent_host }}:{{ config.dogstatsd_port }}</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <div class="main-grid">
                <!-- Sidebar Navigation -->
                <aside class="sidebar">
                    <nav>
                        <div class="nav-section">
                            <div class="nav-title">Metrics</div>
                            <div class="nav-item active" data-view="metrics-api">
                                <span class="nav-item-icon">üìä</span>
                                <span class="nav-item-label">API Submission</span>
                            </div>
                            <div class="nav-item" data-view="dogstatsd">
                                <span class="nav-item-icon">üì°</span>
                                <span class="nav-item-label">DogStatsD Submission</span>
                            </div>
                        </div>
                        <div class="nav-section">
                            <div class="nav-title">Logs</div>
                            <div class="nav-item" data-view="logs-api">
                                <span class="nav-item-icon">üìù</span>
                                <span class="nav-item-label">API Submission</span>
                            </div>
                            <div class="nav-item" data-view="agent-file">
                                <span class="nav-item-icon">üìÅ</span>
                                <span class="nav-item-label">Agent Submission</span>
                            </div>
                        </div>
                        <div class="nav-section">
                            <div class="nav-title">Tools</div>
                            <div class="nav-item" data-view="history">
                                <span class="nav-item-icon">üìú</span>
                                <span class="nav-item-label">History</span>
                            </div>
                        </div>
                    </nav>
                </aside>

                <!-- Content Panel -->
                <section class="content-panel">
                    <!-- Metrics API View -->
                    <div id="view-metrics-api" class="view-content">
                        <div class="panel-header">
                            <h2 class="panel-title">Metrics API Submission</h2>
                            <div class="panel-tabs" id="metrics-api-tabs">
                                <button class="panel-tab active" data-tab="json" onclick="switchTab('metrics-api-tabs', 'json')">JSON</button>
                                <button class="panel-tab" data-tab="form" onclick="switchTab('metrics-api-tabs', 'form')">Form</button>
                            </div>
                        </div>
                        <div class="panel-body">
                            <!-- JSON Tab -->
                            <div id="metrics-api-tabs-json" class="tab-content">
                                <div class="editor-area">
                                    <div class="editor-toolbar">
                                        <div class="presets-dropdown">
                                            <button class="btn btn-secondary btn-sm" onclick="forwardog.togglePresets('presets-metrics-api')">
                                                üìã Presets
                                            </button>
                                            <div id="presets-metrics-api" class="presets-menu"></div>
                                        </div>
                                        <div class="editor-actions">
                                            <span class="shortcut-hint">Ctrl+Enter to submit</span>
                                            <button class="btn btn-secondary btn-sm" onclick="forwardog.formatJson('metrics-api-json')">Format</button>
                                            <button class="btn btn-secondary btn-sm" onclick="forwardog.insertNowTimestamp('metrics-api-json')">‚è±Ô∏è Now</button>
                                        </div>
                                    </div>
                                    <textarea id="metrics-api-json" class="form-textarea" placeholder='{"series": [...]}'>{
  "series": [
    {
      "metric": "forwardog.api.gauge",
      "type": 3,
      "points": [
        {
          "timestamp": {{ (config.dd_site | length) * 0 + 1737158400 }},
          "value": 42
        }
      ],
      "resources": [
        {
          "name": "forwardog-test",
          "type": "host"
        }
      ],
      "tags": [
        "env:test",
        "source:forwardog"
      ]
    }
  ]
}</textarea>
                                </div>
                                <div class="mt-4">
                                    <button id="btn-submit-metrics-api" class="btn btn-primary btn-block" onclick="forwardog.submitMetricsApi()">
                                        üì§ Submit Metrics
                                    </button>
                                </div>
                            </div>

                            <!-- Form Tab -->
                            <div id="metrics-api-tabs-form" class="tab-content hidden">
                                <div class="form-group">
                                    <label class="form-label">Metric Name</label>
                                    <input type="text" id="metric-name" class="form-input" value="forwardog.api.gauge" placeholder="my.metric.name">
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Type</label>
                                        <select id="metric-type" class="form-select">
                                            <option value="3">Gauge</option>
                                            <option value="1">Count</option>
                                            <option value="2">Rate</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Value</label>
                                        <input type="number" id="metric-value" class="form-input" value="42" step="any">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Timestamp</label>
                                    <div style="display: flex; gap: 8px;">
                                        <input type="number" id="metric-timestamp" class="form-input" placeholder="Unix timestamp (seconds)" style="flex: 1;">
                                        <button type="button" class="btn btn-secondary" onclick="forwardog.setFormTimestampNow()">‚è±Ô∏è Now</button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Host</label>
                                    <input type="text" id="metric-host" class="form-input" value="forwardog-test" placeholder="hostname">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Tags (comma-separated)</label>
                                    <input type="text" id="metric-tags" class="form-input" value="env:test,source:forwardog" placeholder="env:prod,service:myapp">
                                </div>
                                <div class="mt-4">
                                    <button id="btn-submit-metrics-form" class="btn btn-primary btn-block" onclick="forwardog.submitMetricsForm()">
                                        üì§ Submit Metric
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DogStatsD View - Python IDE Style -->
                    <div id="view-dogstatsd" class="view-content hidden">
                        <div class="panel-header">
                            <h2 class="panel-title">DogStatsD Submission</h2>
                            <div class="panel-tabs">
                                <span style="font-size: 0.8rem; color: var(--text-muted);">Agent: {{ config.dd_agent_host }}:{{ config.dogstatsd_port }}</span>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div class="editor-area">
                                <div class="editor-toolbar">
                                    <div class="presets-dropdown">
                                        <button class="btn btn-secondary btn-sm" onclick="forwardog.togglePresets('presets-dogstatsd')">
                                            üìã Presets
                                        </button>
                                        <div id="presets-dogstatsd" class="presets-menu"></div>
                                    </div>
                                    <div class="editor-actions">
                                        <span class="shortcut-hint">Ctrl+Enter to run</span>
                                    </div>
                                </div>
                                <div class="python-ide">
                                    <div class="ide-header">
                                        <span class="ide-filename">üìÑ dogstatsd_metric.py</span>
                                    </div>
                                    <div class="code-editor-wrapper">
                                        <pre class="code-highlight"><code id="dogstatsd-code-highlight" class="language-python"></code></pre>
                                        <textarea id="dogstatsd-code" class="code-editor-input" spellcheck="false" oninput="forwardog.updateCodeHighlight()">from datadog import initialize, statsd

# Initialize DogStatsD client
options = {
    'statsd_host': '{{ config.dd_agent_host }}',
    'statsd_port': {{ config.dogstatsd_port }}
}
initialize(**options)

# Gauge - Current value
statsd.gauge('forwardog.dogstatsd.gauge', 42, tags=['env:test', 'source:forwardog'])
</textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4">
                                <button id="btn-run-dogstatsd" class="btn btn-primary btn-block" onclick="forwardog.runDogStatsDCode()">
                                    ‚ñ∂Ô∏è Run Code
                                </button>
                            </div>
                            <div id="dogstatsd-output" class="code-output hidden">
                                <div class="output-header">üì§ Output</div>
                                <pre class="output-content"></pre>
                            </div>
                        </div>
                    </div>

                    <!-- Logs API View -->
                    <div id="view-logs-api" class="view-content hidden">
                        <div class="panel-header">
                            <h2 class="panel-title">Logs API Submission</h2>
                            <div class="panel-tabs" id="logs-api-tabs">
                                <button class="panel-tab active" data-tab="json" onclick="switchTab('logs-api-tabs', 'json')">JSON</button>
                                <button class="panel-tab" data-tab="form" onclick="switchTab('logs-api-tabs', 'form')">Form</button>
                            </div>
                        </div>
                        <div class="panel-body">
                            <!-- JSON Tab -->
                            <div id="logs-api-tabs-json" class="tab-content">
                                <div class="editor-area">
                                    <div class="editor-toolbar">
                                        <div class="presets-dropdown">
                                            <button class="btn btn-secondary btn-sm" onclick="forwardog.togglePresets('presets-logs-api')">
                                                üìã Presets
                                            </button>
                                            <div id="presets-logs-api" class="presets-menu"></div>
                                        </div>
                                        <div class="editor-actions">
                                            <span class="shortcut-hint">Ctrl+Enter to submit</span>
                                            <button class="btn btn-secondary btn-sm" onclick="forwardog.formatJson('logs-api-json')">Format</button>
                                        </div>
                                    </div>
                                    <textarea id="logs-api-json" class="form-textarea" placeholder='[{"message": "Test log", "ddsource": "forwardog", "service": "forwardog-test", "status": "info"}]'>[
  {
    "message": "This is a test log from forwardog",
    "ddsource": "forwardog",
    "service": "forwardog-test",
    "status": "info",
    "ddtags": "env:test,source:forwardog"
  }
]</textarea>
                                </div>
                                <div class="mt-4">
                                    <button id="btn-submit-logs-api" class="btn btn-primary btn-block" onclick="forwardog.submitLogsApi()">
                                        üì§ Submit Logs
                                    </button>
                                </div>
                            </div>

                            <!-- Form Tab -->
                            <div id="logs-api-tabs-form" class="tab-content hidden">
                                <div class="form-group">
                                    <label class="form-label">Message</label>
                                    <textarea id="log-message" class="form-textarea" style="min-height: 100px;" placeholder="Enter your log message...">This is a test log from forwardog</textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Service</label>
                                        <input type="text" id="log-service" class="form-input" value="forwardog-test" placeholder="service-name">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Source</label>
                                        <input type="text" id="log-source" class="form-input" value="forwardog" placeholder="source">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Status</label>
                                        <select id="log-status" class="form-select">
                                            <option value="info">Info</option>
                                            <option value="debug">Debug</option>
                                            <option value="warning">Warning</option>
                                            <option value="error">Error</option>
                                            <option value="critical">Critical</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Tags</label>
                                    <input type="text" id="log-tags" class="form-input" value="env:test,source:forwardog" placeholder="key:value,key2:value2">
                                </div>
                                <div class="mt-4">
                                    <button id="btn-submit-logs-form" class="btn btn-primary btn-block" onclick="forwardog.submitLogsForm()">
                                        üì§ Submit Log
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Agent File View -->
                    <div id="view-agent-file" class="view-content hidden">
                        <div class="panel-header">
                            <h2 class="panel-title">Agent Submission</h2>
                        </div>
                        <div class="panel-body">
                            <div class="editor-area">
                                <div class="editor-toolbar">
                                    <div class="presets-dropdown">
                                        <button class="btn btn-secondary btn-sm" onclick="forwardog.togglePresets('presets-agent-file')">
                                            üìã Presets
                                        </button>
                                        <div id="presets-agent-file" class="presets-menu"></div>
                                    </div>
                                    <div class="editor-actions">
                                        <span class="shortcut-hint">Ctrl+Enter to submit</span>
                                    </div>
                                </div>
                                <p class="mb-4" style="font-size: 0.85rem; color: var(--text-muted);">
                                    Write logs to: <code style="background: var(--bg-input); padding: 2px 6px; border-radius: 4px;">{{ config.log_path }}</code>
                                </p>
                                
                                <!-- File Upload Area -->
                                <div class="file-upload-area" id="file-drop-zone" onclick="document.getElementById('log-file-input').click()">
                                    <input type="file" id="log-file-input" accept=".log,.txt,.json" style="display: none;" onchange="forwardog.handleLogFileUpload(event)">
                                    <div class="file-upload-content">
                                        <span class="file-upload-icon">üìÅ</span>
                                        <span class="file-upload-text">Drop log file here or click to upload</span>
                                        <span class="file-upload-hint">.log, .txt, .json files supported</span>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                        <label class="form-label" style="margin-bottom: 0;">Log Messages (one per line)</label>
                                        <button class="btn btn-secondary btn-sm" onclick="forwardog.updateAgentFileTimestamps()">‚è±Ô∏è Now</button>
                                    </div>
                                    <textarea id="agent-file-messages" class="form-textarea" style="min-height: 150px;" placeholder="Enter log messages, one per line...">This is a test log line from forwardog
Application started successfully
Processing request ID 12345</textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Service</label>
                                        <input type="text" id="agent-file-service" class="form-input" value="forwardog-test" placeholder="service-name">
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4">
                                <button id="btn-submit-agent-file" class="btn btn-primary btn-block" onclick="forwardog.submitAgentFile()">
                                    üìù Write to Log File
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- History View -->
                    <div id="view-history" class="view-content hidden">
                        <div class="panel-header">
                            <h2 class="panel-title">Request History</h2>
                            <div class="editor-actions">
                                <span class="shortcut-hint" id="history-count">0 items</span>
                                <button class="btn btn-secondary btn-sm" onclick="forwardog.exportHistory()">üì• Export</button>
                                <button class="btn btn-secondary btn-sm" onclick="forwardog.clearHistory()">üóëÔ∏è Clear</button>
                            </div>
                        </div>
                        <div class="panel-body" id="history-container">
                            <div class="empty-state">
                                <div class="empty-state-icon">üìú</div>
                                <div class="empty-state-text">History will appear here as you make requests.<br><small>Stored in browser localStorage</small></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Results Panel -->
                <aside class="results-panel">
                    <div class="results-header">
                        <h3 class="results-title">Results</h3>
                        <button class="btn btn-secondary btn-sm" onclick="forwardog.clearResults()">Clear</button>
                    </div>
                    <div class="results-body" id="results-container">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìã</div>
                            <div class="empty-state-text">No results yet. Submit a request to see results here.</div>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </main>

    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="theme-toggle" title="Toggle theme">
        <span class="icon-sun">‚òÄÔ∏è</span>
        <span class="icon-moon">üåô</span>
    </button>

    <script src="/static/js/app.js"></script>
    
    <!-- Metrics Background Animation -->
    <script>
    (function() {
        const canvas = document.getElementById('metrics-bg');
        const ctx = canvas.getContext('2d');
        
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.addEventListener('resize', resize);
        
        const isDark = () => document.documentElement.getAttribute('data-theme') !== 'light';
        
        const colors = {
            dark: [
                { line: 'rgba(99, 102, 241, 0.20)', fill: 'rgba(99, 102, 241, 0.035)' },
                { line: 'rgba(6, 182, 212, 0.18)', fill: 'rgba(6, 182, 212, 0.03)' },
                { line: 'rgba(139, 92, 246, 0.16)', fill: 'rgba(139, 92, 246, 0.025)' },
                { line: 'rgba(20, 184, 166, 0.14)', fill: 'rgba(20, 184, 166, 0.02)' },
                { line: 'rgba(59, 130, 246, 0.12)', fill: 'rgba(59, 130, 246, 0.018)' }
            ],
            light: [
                { line: 'rgba(99, 102, 241, 0.25)', fill: 'rgba(99, 102, 241, 0.04)' },
                { line: 'rgba(6, 182, 212, 0.22)', fill: 'rgba(6, 182, 212, 0.035)' },
                { line: 'rgba(139, 92, 246, 0.20)', fill: 'rgba(139, 92, 246, 0.03)' },
                { line: 'rgba(20, 184, 166, 0.18)', fill: 'rgba(20, 184, 166, 0.025)' },
                { line: 'rgba(59, 130, 246, 0.15)', fill: 'rgba(59, 130, 246, 0.02)' }
            ]
        };
        
        function drawGrid() {
            const gridColor = isDark() ? 'rgba(255, 255, 255, 0.03)' : 'rgba(0, 0, 0, 0.03)';
            ctx.strokeStyle = gridColor;
            ctx.lineWidth = 1;
            
            const gridSpacingX = 80;
            const gridSpacingY = 60;
            
            for (let x = 0; x < canvas.width; x += gridSpacingX) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            for (let y = 0; y < canvas.height; y += gridSpacingY) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }
        
        class MetricSeries {
            constructor(index, total) {
                this.index = index;
                this.total = total;
                this.pointSpacing = 12;
                this.reset();
            }
            
            reset() {
                const h = canvas.height;
                const segment = h / (this.total + 1);
                this.baseY = segment * (this.index + 1);
                this.amplitude = 25 + Math.random() * 35;
                this.currentValue = this.baseY;
                this.targetValue = this.baseY;
                this.values = [];
                this.updateCounter = 0;
                this.updateInterval = 25 + Math.floor(Math.random() * 25);
                this.pattern = Math.floor(Math.random() * 4);
                this.patternPhase = 0;
                
                const numPoints = Math.ceil(canvas.width / this.pointSpacing) + 5;
                for (let i = 0; i < numPoints; i++) {
                    this.values.push(this.baseY + (Math.random() - 0.5) * this.amplitude * 0.5);
                }
            }
            
            generateNextValue() {
                this.patternPhase++;
                let newValue;
                
                switch(this.pattern) {
                    case 0:
                        if (Math.random() > 0.92) {
                            newValue = this.baseY + (Math.random() > 0.5 ? 1 : -1) * this.amplitude * (0.7 + Math.random() * 0.5);
                        } else {
                            newValue = this.currentValue + (Math.random() - 0.5) * 8;
                        }
                        break;
                    case 1:
                        const rampUp = (this.patternPhase % 60) / 60;
                        newValue = this.baseY - this.amplitude * 0.5 + rampUp * this.amplitude;
                        newValue += (Math.random() - 0.5) * 10;
                        break;
                    case 2:
                        if (Math.random() > 0.85) {
                            this.targetValue = this.baseY + (Math.random() - 0.5) * this.amplitude;
                        }
                        this.currentValue += (this.targetValue - this.currentValue) * 0.3;
                        newValue = this.currentValue + (Math.random() - 0.5) * 5;
                        break;
                    case 3:
                        const burstChance = Math.random();
                        if (burstChance > 0.97) {
                            newValue = this.baseY + this.amplitude * (0.8 + Math.random() * 0.4);
                        } else if (burstChance > 0.94) {
                            newValue = this.baseY - this.amplitude * (0.5 + Math.random() * 0.3);
                        } else {
                            newValue = this.baseY + (Math.random() - 0.5) * this.amplitude * 0.3;
                        }
                        break;
                    default:
                        newValue = this.baseY + (Math.random() - 0.5) * this.amplitude;
                }
                
                newValue = Math.max(this.baseY - this.amplitude, Math.min(this.baseY + this.amplitude, newValue));
                this.currentValue = newValue;
                return newValue;
            }
            
            update() {
                this.updateCounter++;
                if (this.updateCounter >= this.updateInterval) {
                    this.updateCounter = 0;
                    this.values.shift();
                    this.values.push(this.generateNextValue());
                }
            }
            
            draw(colorIndex) {
                const palette = isDark() ? colors.dark : colors.light;
                const color = palette[colorIndex % palette.length];
                
                const drawCurve = (fill = false) => {
                    ctx.beginPath();
                    if (fill) ctx.moveTo(0, canvas.height);
                    
                    for (let i = 0; i < this.values.length; i++) {
                        const x = i * this.pointSpacing;
                        const y = this.values[i];
                        
                        if (i === 0) {
                            if (fill) ctx.lineTo(x, y);
                            else ctx.moveTo(x, y);
                        } else {
                            const prevX = (i - 1) * this.pointSpacing;
                            const prevY = this.values[i - 1];
                            const cpX = (prevX + x) / 2;
                            ctx.bezierCurveTo(cpX, prevY, cpX, y, x, y);
                        }
                    }
                    
                    if (fill) {
                        ctx.lineTo(canvas.width, canvas.height);
                        ctx.closePath();
                    }
                };
                
                ctx.fillStyle = color.fill;
                drawCurve(true);
                ctx.fill();
                
                ctx.strokeStyle = color.line;
                ctx.lineWidth = 1.5;
                drawCurve(false);
                ctx.stroke();
            }
        }
        
        const series = [];
        const numSeries = 5;
        for (let i = 0; i < numSeries; i++) {
            series.push(new MetricSeries(i, numSeries));
        }
        
        let lastTime = 0;
        function animate(time) {
            if (time - lastTime > 80) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                drawGrid();
                
                series.forEach((s, i) => {
                    s.update();
                    s.draw(i);
                });
                
                lastTime = time;
            }
            requestAnimationFrame(animate);
        }
        
        window.addEventListener('resize', () => {
            resize();
            series.forEach(s => s.reset());
        });
        
        animate(0);
    })();
    </script>
</body>
</html>

